<h3 align="center">Histórico de Empréstimos</h3>

<div align="center">

  <%= search_form_for @q, url: collaborator_path(@collaborator) do |e| %>
    <div>
      <%= e.label :loan_action_eq, "Tipo de Ação" %>
      <%= e.select :loan_action_eq, Loan.loan_actions.map { |k, v| [k.titleize, v] }, include_blank: "Todos" %>
    </div>

    <div>
      <%= e.label :created_at_lteq, "Antes de" %>
      <%= e.date_field :created_at_lteq %>
    </div>

    <div>
      <%= e.label :created_at_gteq, "Depois de" %>
      <%= e.date_field :created_at_gteq %>
    </div>

    <div>
      <%= e.label :created_at_eq, "No dia" %>
      <%= e.date_field :created_at_eq %>
    </div>
    <div>
      <%= e.label :equipment_identifier_cont, "Equipamento (ID)" %>
      <%= e.search_field :equipment_identifier_cont %>
    </div>

    <div>
      <%= e.submit "Filtrar" %>
      <%= link_to "Limpar", collaborator_path(@collaborator) %>
    </div>
  <% end %>

</div>



<div align="center">
  <% if @collaborator.loans.any? %>
    <table border="1px" align="center">
      <thead>
        <tr>
          <th>Ação</th>
          <th>Data</th>
          <th>Equipamento</th>
          <th>Motivo</th>
        </tr>
      </thead>
      <tbody>
        <% @filtered_loans.order(created_at: :desc).each do |loan| %>
          <tr>
            <td>
              <%=
                case loan.loan_action
                when "emprestimo" then "Empréstimo"
                when "devolucao"  then "Devolução"
                when "baixa"      then "Devolução"
                end 
              %>
            </td>
            <td>
              <%= 
                case loan.loan_action
                when "emprestimo" then loan.loan_date
                when "devolucao"  then loan.return_date
                when "baixa"      then loan.discard_date
                end
              %>
            </td>
            <td> <%= loan.equipment.identifier %> </td>
            <td>
              <%= 
              case loan.loan_action
              when "devolucao"  then loan.return_reason
              when "baixa"      then loan.discard_reason
              else "-"
              end
              %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p>Este Colaborador ainda nao fez um empréstimo</p>
  <% end %>
  <br>
  <%= link_to 'Voltar para colaboradores', collaborators_path %>
</div>